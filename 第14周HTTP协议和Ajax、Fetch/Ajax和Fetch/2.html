<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        // 1. XMLHTTPRequest
        // Ajax 想要实现浏览器与服务器之间的异步通信,需要依靠XMLHTTPRequest,它是一个构造函数


        // 2. Ajax的使用步骤
        // 2.1 创建xhr对象

      //  const xhr = new XMLHttpRequest();

        // 2.2准备发送请求
        // xhr.open(
        //     'HTTP方法GET、POST、PUT、DELETE',
        //     '地址URL https://www.imooc.com/api/http/search/suggest?word=js ./index.html ./index.xml ./index',
        //     true // 代表使用异步处理
        // );

        // 调用open并不会真正发送请求,而知识做好发送请求前的准备工作
        
        // 2.3发送请求
        // 调用send()正式发送请求
        // send()的参数是通过请求体携带的数据
        // GET请求不能通过请求体携带数据,因此它对应的send()不能穿入参数
        // xhr.send(null)

        // 2.4 监听事件,处理响应
        // 当获取到响应后,会出发xhr对象的readystatechange事件,可以在该事件中对响应进行处理
       // xhr.onreadystatechange = () => {
            // readystatechange事件监听readyState这个状态的变化
            // 它的值从0~4,一共5个状态
            // 0: 未初始化,尚未调用open()
            // 1: 启动. 已经调用open(),但尚未调用send()
            // 2: 发送. 已经调用send(), 但尚未接受到响应
            // 3: 接收. 已经接收到部分响应数据
            // 4: 完成.已经接收到全部响应数据,而且已经可以在浏览器中使用了
            //if(xhr.readyState !== 4) {
               // return ;
           // };
            // HTTP CODE
            // 获取到响应后,响应的内容会自动填充到xhr对象的属性
            // xhr.status:HTTP 200 404
            // xhr.status.Text: HTTP状态说明 OK  Not Found
           // if((xhr.status >= 200 && xhr.status <= 300)||(xhr.status === 304)){
               // console.log('正常使用响应数据');
                //console.log(xhr.responseText);
           // }
     //   }

        // readystatechange事件也可以配合addEventListener使用,不过IE6-8不兼容
        // 为了兼容性, readystatechange中不使用this, 而是直接使用xhr
        // 用于兼容性的原因, 最好放在open()之前


        // 3. 使用Ajax完成前后端通信
        const url = 'https://www.imooc.com/api/http/search/suggest?word=js';
        const xhr = new XMLHttpRequest();

        xhr.onreadystatechange = () => {
            if (xhr.readyState !== 4) {
                return;
            };

            if (xhr.status >= 200 && xhr.status < 300 || xhr.status === 304) {
                console.log(xhr.responseText);
                console.log(typeof xhr.responseText);
            };
        }

        xhr.open('GET', url, true);
        xhr.send(null);
    </script>
</body>

</html>